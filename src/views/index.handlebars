<div class="d-flex align-items-center justify-content-between mb-3">
  <h2 class="mb-0">Productos</h2>
  <form class="d-flex gap-2" method="get" action="/products">
    <input type="hidden" name="page" value="1" />
    <select class="form-select" name="limit" style="width:120px">
      <option value="10" {{#if (eq limit 10)}}selected{{/if}}>10</option>
      <option value="20" {{#if (eq limit 20)}}selected{{/if}}>20</option>
      <option value="50" {{#if (eq limit 50)}}selected{{/if}}>50</option>
    </select>
    <select class="form-select" name="sort" style="width:140px">
      <option value="">Sin orden</option>
      <option value="asc" {{#if (eq sort "asc")}}selected{{/if}}>Precio asc</option>
      <option value="desc" {{#if (eq sort "desc")}}selected{{/if}}>Precio desc</option>
    </select>
    <input class="form-control" name="query" placeholder="Categoría o disponibilidad" value="{{query}}" style="width:220px" />
    <button class="btn btn-primary" type="submit">Filtrar</button>
  </form>
</div>

{{#if products.length}}
  <div class="row" id="products-list">
    {{#each products}}
      <div class="col-md-4 mb-4">
        <div class="card h-100">
          <img src="{{#if thumbnails.[0]}}{{thumbnails.[0]}}{{else}}https://via.placeholder.com/300x200?text=Sin+Imagen{{/if}}" class="card-img-top" alt="{{title}}" />
          <div class="card-body d-flex flex-column">
            <h5 class="card-title">{{title}}</h5>
            <p class="card-text">{{description}}</p>
            <p class="mb-1"><strong>Precio:</strong> ${{price}}</p>
            <p class="mb-1"><strong>Categoría:</strong> {{category}}</p>
            <p class="mb-3"><strong>Stock:</strong> {{stock}}</p>
            <div class="mt-auto d-flex gap-2">
              <a class="btn btn-outline-secondary" href="/products/{{id}}">Ver detalles</a>
              <button class="btn btn-primary" onclick="addToCart({{id}})">Agregar al carrito</button>
            </div>
          </div>
        </div>
      </div>
    {{/each}}
  </div>
{{else}}
  <div class="alert alert-info" id="no-products">No hay productos para mostrar.</div>
{{/if}}

<nav aria-label="Paginación" class="mt-3">
  <ul class="pagination justify-content-center">
    <li class="page-item {{#unless pagination.hasPrevPage}}disabled{{/unless}}">
      {{#if pagination.hasPrevPage}}
        <a class="page-link" href="/products?page={{pagination.prevPage}}&limit={{limit}}&sort={{sort}}&query={{query}}">Anterior</a>
      {{else}}
        <span class="page-link">Anterior</span>
      {{/if}}
    </li>
    <li class="page-item active"><span class="page-link">{{pagination.page}} / {{pagination.totalPages}}</span></li>
    <li class="page-item {{#unless pagination.hasNextPage}}disabled{{/unless}}">
      {{#if pagination.hasNextPage}}
        <a class="page-link" href="/products?page={{pagination.nextPage}}&limit={{limit}}&sort={{sort}}&query={{query}}">Siguiente</a>
      {{else}}
        <span class="page-link">Siguiente</span>
      {{/if}}
    </li>
  </ul>
  <div class="text-center text-muted">Página {{pagination.page}} de {{pagination.totalPages}}</div>
</nav>